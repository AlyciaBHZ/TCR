========================================
Job: 1080307 on zgpuA1001
Start: Tue Dec  2 16:34:17 +08 2025
Mode: ABLATION (peptide-off)
Log: flowtcr_fold/Immuno_PLM/saved_model/ablation_peptide_off/train_1080307.log
========================================
======================================================================
Stage 1: Immuno-PLM Scaffold Prior Training
======================================================================
Mode: ABLATION (peptide-off)
Data: flowtcr_fold/data/trn.jsonl
Model: ESM=esm2_t33_650M_UR50D + LoRA(rank=16)
Loss weights: λ_pmhc=0.3, λ_bce=0.2, λ_pep=0.1
Output: flowtcr_fold/Immuno_PLM/saved_model/ablation_peptide_off
Device: cuda
======================================================================
[Dataset] Filtered 209407 -> 209406 (require peptide)
[Dataset] Has MHC: 135104 (64.5%), Missing MHC: 74302
[Dataset] Samples: 209406 | Gene vocab HV/HJ/LV/LJ = 401/110/236/177 | Alleles=175

[pos_weight stats]
  h_v: min=4.27, max=50.00, mean=40.73
  h_j: min=2.71, max=50.00, mean=38.28
  l_v: min=4.65, max=50.00, mean=35.53
  l_j: min=5.60, max=50.00, mean=27.87
[Dataset] Filtered 24020 -> 24020 (require peptide)
[Dataset] Has MHC: 15495 (64.5%), Missing MHC: 8525
[Dataset] Samples: 24020 | Gene vocab HV/HJ/LV/LJ = 401/110/236/177 | Alleles=175
[LoRA] Trainable params: 5,406,720/656,449,974 (0.82%)
Params: 6,083,228/657,126,482 trainable (0.93%)

Building frequency baseline...
Frequency Baseline R@K (train):
  h_v: R@1=0.077, R@5=0.258, R@10=0.402, R@20=0.578
  h_j: R@1=0.142, R@5=0.494, R@10=0.739, R@20=0.947
  l_v: R@1=0.067, R@5=0.216, R@10=0.347, R@20=0.535
  l_j: R@1=0.046, R@5=0.152, R@10=0.248, R@20=0.408

Starting training from epoch 1...

Epoch 1/100
  Train: loss=9.0309 | NCE(mhc)=5.688 NCE(pmhc)=7.902 NCE(pep)=8.113 | BCE=0.806
  Val: loss=10.2475 | NCE(mhc)=5.601 NCE(pmhc)=7.879 NCE(pep)=8.083 | BCE=7.375
       HV: R@1=0.378 R@5=0.750 R@10=0.867 R@20=0.962 | HJ: R@1=0.204 R@5=0.659 R@10=0.826 R@20=0.946
       LV: R@1=0.506 R@5=0.925 R@10=0.997 R@20=1.000 | LJ: R@1=0.515 R@5=0.934 R@10=0.998 R@20=1.000
       Baseline R@10: HV=0.393 HJ=0.744 LV=0.331 LJ=0.236
       Δ vs Baseline: HV=+0.474 HJ=+0.082 LV=+0.666 LJ=+0.762
       KL_HV=1.4728 | KL_HJ=1.4022
  ✓ New best model saved (loss=10.2475)

Epoch 2/100
  Train: loss=8.7539 | NCE(mhc)=5.586 NCE(pmhc)=7.851 NCE(pep)=8.065 | BCE=0.032
  Val: loss=10.7046 | NCE(mhc)=5.566 NCE(pmhc)=7.793 NCE(pep)=8.015 | BCE=9.997
       HV: R@1=0.395 R@5=0.760 R@10=0.871 R@20=0.965 | HJ: R@1=0.216 R@5=0.655 R@10=0.824 R@20=0.945
       LV: R@1=0.513 R@5=0.926 R@10=0.996 R@20=1.000 | LJ: R@1=0.538 R@5=0.930 R@10=0.998 R@20=1.000
       Baseline R@10: HV=0.393 HJ=0.744 LV=0.331 LJ=0.236
       Δ vs Baseline: HV=+0.479 HJ=+0.080 LV=+0.665 LJ=+0.762
       KL_HV=2.6296 | KL_HJ=2.4713

Epoch 3/100
  Train: loss=8.7164 | NCE(mhc)=5.559 NCE(pmhc)=7.835 NCE(pep)=8.051 | BCE=0.010
  Val: loss=11.0402 | NCE(mhc)=5.551 NCE(pmhc)=7.810 NCE(pep)=8.027 | BCE=11.715
       HV: R@1=0.396 R@5=0.762 R@10=0.879 R@20=0.967 | HJ: R@1=0.212 R@5=0.653 R@10=0.823 R@20=0.948
       LV: R@1=0.507 R@5=0.933 R@10=0.997 R@20=1.000 | LJ: R@1=0.544 R@5=0.939 R@10=0.998 R@20=1.000
       Baseline R@10: HV=0.393 HJ=0.744 LV=0.331 LJ=0.236
       Δ vs Baseline: HV=+0.487 HJ=+0.079 LV=+0.666 LJ=+0.762
       KL_HV=3.7447 | KL_HJ=3.4087

Epoch 4/100
  Train: loss=8.7012 | NCE(mhc)=5.548 NCE(pmhc)=7.824 NCE(pep)=8.043 | BCE=0.006
  Val: loss=11.2200 | NCE(mhc)=5.552 NCE(pmhc)=7.773 NCE(pep)=8.001 | BCE=12.682
       HV: R@1=0.394 R@5=0.762 R@10=0.878 R@20=0.968 | HJ: R@1=0.215 R@5=0.664 R@10=0.827 R@20=0.946
       LV: R@1=0.510 R@5=0.931 R@10=0.996 R@20=1.000 | LJ: R@1=0.542 R@5=0.935 R@10=0.998 R@20=1.000
       Baseline R@10: HV=0.393 HJ=0.744 LV=0.331 LJ=0.236
       Δ vs Baseline: HV=+0.486 HJ=+0.083 LV=+0.665 LJ=+0.762
       KL_HV=4.4150 | KL_HJ=4.1584

Epoch 5/100
  Train: loss=8.6827 | NCE(mhc)=5.537 NCE(pmhc)=7.807 NCE(pep)=8.031 | BCE=0.004
  Val: loss=11.2491 | NCE(mhc)=5.530 NCE(pmhc)=7.810 NCE(pep)=8.026 | BCE=12.867
       HV: R@1=0.412 R@5=0.764 R@10=0.879 R@20=0.970 | HJ: R@1=0.220 R@5=0.659 R@10=0.826 R@20=0.947
       LV: R@1=0.536 R@5=0.932 R@10=0.997 R@20=1.000 | LJ: R@1=0.537 R@5=0.936 R@10=0.998 R@20=1.000
       Baseline R@10: HV=0.393 HJ=0.744 LV=0.331 LJ=0.236
       Δ vs Baseline: HV=+0.487 HJ=+0.082 LV=+0.666 LJ=+0.761
       KL_HV=4.2250 | KL_HJ=3.8856

Epoch 6/100
  Train: loss=8.6704 | NCE(mhc)=5.526 NCE(pmhc)=7.804 NCE(pep)=8.026 | BCE=0.003
  Val: loss=11.3448 | NCE(mhc)=5.536 NCE(pmhc)=7.770 NCE(pep)=7.996 | BCE=13.391
       HV: R@1=0.403 R@5=0.766 R@10=0.881 R@20=0.970 | HJ: R@1=0.222 R@5=0.652 R@10=0.828 R@20=0.946
       LV: R@1=0.518 R@5=0.935 R@10=0.997 R@20=1.000 | LJ: R@1=0.537 R@5=0.935 R@10=0.998 R@20=1.000
       Baseline R@10: HV=0.393 HJ=0.744 LV=0.331 LJ=0.236
       Δ vs Baseline: HV=+0.488 HJ=+0.084 LV=+0.666 LJ=+0.762
       KL_HV=4.6881 | KL_HJ=4.3311

Epoch 7/100
  Train: loss=8.6682 | NCE(mhc)=5.525 NCE(pmhc)=7.802 NCE(pep)=8.025 | BCE=0.002
  Val: loss=11.3931 | NCE(mhc)=5.534 NCE(pmhc)=7.787 NCE(pep)=8.013 | BCE=13.606
       HV: R@1=0.397 R@5=0.768 R@10=0.881 R@20=0.969 | HJ: R@1=0.221 R@5=0.657 R@10=0.829 R@20=0.946
       LV: R@1=0.512 R@5=0.930 R@10=0.996 R@20=1.000 | LJ: R@1=0.536 R@5=0.935 R@10=0.997 R@20=1.000
       Baseline R@10: HV=0.393 HJ=0.744 LV=0.331 LJ=0.236
       Δ vs Baseline: HV=+0.488 HJ=+0.086 LV=+0.665 LJ=+0.761
       KL_HV=4.4576 | KL_HJ=4.2296

Epoch 8/100
  Train: loss=8.6502 | NCE(mhc)=5.509 NCE(pmhc)=7.797 NCE(pep)=8.016 | BCE=0.002
  Val: loss=11.3323 | NCE(mhc)=5.516 NCE(pmhc)=7.798 NCE(pep)=8.016 | BCE=13.377
       HV: R@1=0.400 R@5=0.762 R@10=0.886 R@20=0.970 | HJ: R@1=0.216 R@5=0.657 R@10=0.829 R@20=0.946
       LV: R@1=0.534 R@5=0.938 R@10=0.996 R@20=1.000 | LJ: R@1=0.539 R@5=0.934 R@10=0.998 R@20=1.000
       Baseline R@10: HV=0.393 HJ=0.744 LV=0.331 LJ=0.236
       Δ vs Baseline: HV=+0.494 HJ=+0.085 LV=+0.665 LJ=+0.762
       KL_HV=4.2866 | KL_HJ=3.9658

Epoch 9/100
